{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block content %}
{% load static %}
<div class="page-header">
    <div class="page-title">
        <h4>Product Add</h4>
        <h6>Create new product</h6>
    </div>
</div>
<form action="" method="post" autocomplete="off" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        {{form.productname|as_crispy_field}}
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        {{form.category_name|as_crispy_field}}
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label for="subcategory-dropdown">Sub Category</label>
                        <select name="subcategory" id="subcategory-dropdown" class="form-control" disabled>
                            <option value="">Select Subcategory</option>
                        </select>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        {{form.sku|as_crispy_field}}
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        {{form.unit|as_crispy_field}}
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        {{form.status|as_crispy_field}}
                    </div>
                </div>
                <div class="col-lg-6 col-sm-6 col-12">
                    <div class="form-group">
                        {{form.product_image|as_crispy_field}}
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group">
                        {{form.description|as_crispy_field}}
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group">
                    </div>
                </div>
                <div class="col-lg-12">
                    <button type="submit" class="btn btn-submit me-2">Submit</button>
                    <a href="{% url 'product_list' %}" class="btn btn-cancel">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  $("#id_category_name").change(function() {
    var category_id = $(this).val();
    if (category_id !== "") {
      $("#subcategory-dropdown").prop("disabled", false);
      $.ajax({
        url: "{% url 'get_subcategories' %}",
        data: { category_id: category_id },
        dataType: "json",
        success: function(data) {
          $("#subcategory-dropdown").empty();
          $("#subcategory-dropdown").append('<option value="">Select Subcategory</option>');
          $.each(data, function(key, value) {
            $("#subcategory-dropdown").append('<option value="' + value.id + '">' + value.name + '</option>');
          });
        },
        error: function(xhr, status, error) {
          console.error(xhr.responseText);
        }
      });
    } else {
      $("#subcategory-dropdown").empty().prop("disabled", true);
      $("#subcategory-dropdown").append('<option value="">Select Subcategory</option>');
    }
  });
});
</script>

{% endblock content %}